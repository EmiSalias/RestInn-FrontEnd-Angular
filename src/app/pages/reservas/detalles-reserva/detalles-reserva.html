<!-- src/app/pages/reservas/detalle-reserva/detalle-reserva.html -->
<section class="reserva-detail">

  <button class="back-btn" type="button" (click)="volver()">
    ← Volver
  </button>

  <div *ngIf="loading" class="status">Cargando reserva...</div>
  <div *ngIf="!loading && errorMsg" class="status error">{{ errorMsg }}</div>

  <ng-container *ngIf="!loading && !errorMsg && reserva as r">

    <header class="detail-header">
      <div>
        <h1>Reserva #{{ r.id }}</h1>
        <p class="subtitle">
          Habitación {{ r.habitacionNumero || r.habitacionId }}
          · {{ r.fechaIngreso | date:'dd/MM/yyyy' }} — {{ r.fechaSalida | date:'dd/MM/yyyy' }}
        </p>
      </div>

      <span class="status-chip" [ngClass]="r.estado?.toLowerCase()">
        {{ estadoLabel(r.estado) }}
      </span>
    </header>

    <div class="detail-layout">
      <!-- Columna principal -->
      <div class="detail-main">
        <section class="detail-block">
          <h2>Estadía</h2>
          <div class="detail-grid">
            <div>
              <div class="label">Ingreso</div>
              <div class="value">{{ r.fechaIngreso | date:'dd/MM/yyyy' }}</div>
            </div>
            <div>
              <div class="label">Salida</div>
              <div class="value">{{ r.fechaSalida | date:'dd/MM/yyyy' }}</div>
            </div>
            <div>
              <div class="label">Noches</div>
              <div class="value">{{ noches }}</div>
            </div>
          </div>
        </section>

        <section class="detail-block">
          <h2>Titular de la reserva</h2>
          <p class="value strong">
            {{ r.usuario?.nombre }} {{ r.usuario?.apellido }}
          </p>
          <p class="muted" *ngIf="r.usuario?.email">
            {{ r.usuario?.email }}
          </p>
        </section>

        <section class="detail-block">
          <h2>Huéspedes</h2>

          <ng-container *ngIf="huespedes.length; else sinHuespedes">
            <ul class="guest-list">
              <li *ngFor="let h of huespedes">
                <div class="guest-name">
                  {{ h.nombre }} {{ h.apellido }}
                </div>
                <div class="guest-meta">
                  <span *ngIf="h.dni">DNI {{ h.dni }}</span>
                </div>
              </li>
            </ul>
          </ng-container>

          <ng-template #sinHuespedes>
            <p class="muted">
              No se registraron huéspedes adicionales para esta reserva.
            </p>
          </ng-template>
        </section>
      </div>

      <!-- Columna lateral -->
      <aside class="detail-sidebar">
        <div class="room-card">
          <div class="room-img-wrapper">
            <img [src]="getHabitacionImage()" alt="Habitación" />
          </div>

          <div class="room-body">
            <div class="room-tag">
              Habitación {{ r.habitacionNumero || r.habitacionId }}
            </div>
            <div class="muted">
              Estado: {{ estadoLabel(r.estado) }}
            </div>

            <!-- Botones debajo de la foto -->
            <div class="detail-header-actions">
              <!-- Botón de Confirmar solo para ADMIN/RECEPCIONISTA -->
              <button *ngIf="puedeConfirmarReserva" class="btn" (click)="confirmarReserva()">
                Confirmar reserva
              </button>
              <button *ngIf="puedeCheckIn" class="btn" (click)="checkIn()">
                Realizar check-in
              </button>

              <button *ngIf="puedeCheckOut" class="btn" (click)="checkOut()">
                Realizar check-out
              </button>

            </div>
          </div>
        </div>
      </aside>
    </div>
  </ng-container>
</section>