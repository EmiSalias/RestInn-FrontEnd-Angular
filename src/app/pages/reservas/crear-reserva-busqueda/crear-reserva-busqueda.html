<main class="page-reserva-buscar">

    <!-- CARD de fechas -->
    <section class="buscar-card">
        <h2>Crear reserva</h2>
        <p class="subtitle">
            Elegí las fechas de <strong>check-in</strong> y <strong>check-out</strong> para ver las habitaciones
            disponibles.
        </p>

        <div class="date-selectors">
            <!-- Check-in -->
            <div class="date-tile" (click)="openPicker(checkInInput, $event)">
                <i class="fa-regular fa-calendar-check icon"></i>
                <div class="date-text">
                    <div class="label">Check-in</div>
                    <div class="value">
                        {{ fechaIngreso || 'Seleccionar fecha' }}
                    </div>
                </div>
                <input #checkInInput type="date" [min]="todayStr" [(ngModel)]="fechaIngreso"
                    (change)="onFechasChange()" />
            </div>

            <!-- Check-out -->
            <div class="date-tile" (click)="openPicker(checkOutInput, $event)">
                <i class="fa-regular fa-calendar-minus icon"></i>
                <div class="date-text">
                    <div class="label">Check-out</div>
                    <div class="value">
                        {{ fechaSalida || 'Seleccionar fecha' }}
                    </div>
                </div>
                <input #checkOutInput type="date" [min]="fechaIngreso || todayStr" [(ngModel)]="fechaSalida"
                    (change)="onFechasChange()" />
            </div>
        </div>


        <div class="error" *ngIf="rangoInvalido">
            La fecha de salida debe ser posterior a la fecha de ingreso.
        </div>
    </section>

    <!-- RESULTADOS -->
    <section class="result-section" *ngIf="fechaIngreso && fechaSalida">

        <div class="status" *ngIf="loading">Buscando habitaciones disponibles...</div>
        <div class="status error" *ngIf="!loading && errorMsg">{{ errorMsg }}</div>

        <ng-container *ngIf="!loading && !errorMsg && !rangoInvalido">
            <div class="result-summary" *ngIf="habitacionesDisponibles.length">
                Habitaciones disponibles del
                <strong>{{ fechaIngreso }}</strong>
                al
                <strong>{{ fechaSalida }}</strong>
                ({{ habitacionesDisponibles.length }})
            </div>

            <div class="empty" *ngIf="!habitacionesDisponibles.length">
                No hay habitaciones disponibles en ese rango de fechas.
            </div>

            <div class="grid-habs" *ngIf="habitacionesDisponibles.length">
                <article class="hab-card" *ngFor="let h of habitacionesDisponibles">

                    <div class="hab-card__img" *ngIf="getMainImageDataUrl(h) as url; else sinImg">
                        <img [src]="url" [alt]="'Habitación ' + h.numero" (error)="onImgError($event)">
                    </div>
                    <ng-template #sinImg>
                        <div class="hab-card__img hab-card__img--placeholder">
                            Sin imagen
                        </div>
                    </ng-template>

                    <div class="hab-card__body">
                        <div class="hab-card__title">Habitación {{ h.numero }}</div>
                        <div class="hab-card__meta">
                            <span>{{ h.capacidad }} huésped(es)</span>
                            <span>\${{ h.precioNoche }} / noche</span>
                        </div>
                    </div>

                    <div class="hab-card__footer">
                        <button type="button" (click)="reservar(h)">
                            Reservar
                        </button>
                    </div>
                </article>
            </div>
        </ng-container>
    </section>
</main>