<main class="page-reserva-buscar">

    <!-- CARD de fechas -->
    <section class="buscar-card">
        <h2>Crear reserva</h2>
        <p class="subtitle">
            Elegí las fechas de <strong>check-in</strong> y <strong>check-out</strong> para ver las habitaciones
            disponibles.
        </p>

        <div class="date-selectors">
            <!-- Check-in -->
            <div class="date-tile" (click)="openPicker(checkInInput, $event)">
                <i class="fa-regular fa-calendar-check icon"></i>
                <div class="date-text">
                    <div class="label">Check-in</div>
                    <div class="value">
                        {{ fechaIngreso || 'Seleccionar fecha' }}
                    </div>
                </div>
                <input #checkInInput type="date" [min]="todayStr" [(ngModel)]="fechaIngreso"
                    (change)="onFechasChange()" />

            </div>

            <!-- Check-out -->
            <div class="date-tile" (click)="openPicker(checkOutInput, $event)">
                <i class="fa-regular fa-calendar-minus icon"></i>
                <div class="date-text">
                    <div class="label">Check-out</div>
                    <div class="value">
                        {{ fechaSalida || 'Seleccionar fecha' }}
                    </div>
                </div>
                <input #checkOutInput type="date" [min]="fechaIngreso || todayStr" [(ngModel)]="fechaSalida"
                    (change)="onFechasChange()" />
            </div>
        </div>

        @if (rangoInvalido) {
          <div class="error">
            La fecha de salida debe ser posterior a la fecha de ingreso.
          </div>
        }
    </section>

    <!-- RESULTADOS -->
    @if (fechaIngreso && fechaSalida) {
      <section class="result-section">

        @if (loading) {
          <div class="status">Buscando habitaciones disponibles...</div>
        }
        @if (!loading && errorMsg) {
          <div class="status error">{{ errorMsg }}</div>
        }

        @if (!loading && !errorMsg && !rangoInvalido) {
          
          @if (habitacionesDisponibles.length > 0) {
            <div class="result-summary">
              Habitaciones disponibles del
              <strong>{{ fechaIngreso }}</strong>
              al
              <strong>{{ fechaSalida }}</strong>
              ({{ habitacionesDisponibles.length }})
            </div>
          } @else {
            <div class="empty">
              No hay habitaciones disponibles en ese rango de fechas.
            </div>
          }

          @if (habitacionesDisponibles.length > 0) {
            <div class="grid-habs">
              @for (h of habitacionesDisponibles; track h.id) {
                <article class="hab-card">

                  @if (getMainImageDataUrl(h); as url) {
                    <div class="hab-card__img">
                      <img [src]="url" [alt]="'Habitación ' + h.numero" (error)="onImgError($event)">
                    </div>
                  } @else {
                    <div class="hab-card__img hab-card__img--placeholder">
                        Sin imagen
                    </div>
                  }

                  <div class="hab-card__body">
                      <div class="hab-card__title">Habitación {{ h.numero }}</div>
                      <div class="hab-card__meta">
                          <span>{{ h.capacidad }} huésped(es)</span>
                          <span>\${{ h.precioNoche }} / noche</span>
                      </div>
                  </div>

                  <div class="hab-card__footer">
                      <button type="button" (click)="reservar(h)">
                          Reservar
                      </button>
                  </div>
                </article>
              }
            </div>
          }
        }
      </section>
    }
</main>