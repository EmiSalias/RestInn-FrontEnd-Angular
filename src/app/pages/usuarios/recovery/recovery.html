<section class="auth-page">
  <div class="auth-card">

    <ng-container [ngSwitch]="step">

      <!-- PASO 1: EMAIL -->
      <form *ngSwitchCase="'email'">
        <h1>Recuperar contraseña</h1>
        <p class="subtitle">
          Ingresá el correo con el que te registraste.
        </p>

        <div class="field">
          <label for="email">Correo electrónico</label>
          <input id="email" type="email" [formControl]="emailCtrl" />
          <div class="field-error" *ngIf="emailCtrl.touched && emailCtrl.invalid">
            Ingresá un correo válido.
          </div>
        </div>

        <button class="btn-gold" type="button" (click)="onStart()" [disabled]="loading">
          Enviar código
        </button>

        <button class="link-under" type="button" (click)="goToSignIn()">
          Volver al inicio de sesión
        </button>

        <p class="helper">
          Si el mail existe recibirá un código de recuperación.
        </p>
      </form>

      <!-- PASO 2: CÓDIGO (igual que en SignUp) -->
      <div *ngSwitchCase="'code'" [formGroup]="codeForm">
        <h1>Ingresá el código</h1>
        <p class="subtitle">
          Te enviamos un código de 6 dígitos a <strong>{{ emailCtrl.value }}</strong>.
        </p>

        <div class="code-inputs">
          <input class="code-box" maxlength="1" inputmode="numeric" formControlName="d1" />
          <input class="code-box" maxlength="1" inputmode="numeric" formControlName="d2" />
          <input class="code-box" maxlength="1" inputmode="numeric" formControlName="d3" />
          <input class="code-box" maxlength="1" inputmode="numeric" formControlName="d4" />
          <input class="code-box" maxlength="1" inputmode="numeric" formControlName="d5" />
          <input class="code-box" maxlength="1" inputmode="numeric" formControlName="d6" />
        </div>

        <div class="field-error" *ngIf="codeForm.touched && codeForm.invalid">
          Ingresá los 6 dígitos del código.
        </div>

        <button class="btn-gold" type="button" (click)="onVerifyCode()" [disabled]="loading">
          Continuar
        </button>

        <button class="link-under" type="button" (click)="step = 'email'">
          Volver a ingresar correo
        </button>
      </div>

      <!-- PASO 3: NUEVA CONTRASEÑA -->
      <form *ngSwitchCase="'reset'" [formGroup]="passForm" (ngSubmit)="onReset()">
        <h1>Nueva contraseña</h1>
        <p class="subtitle">
          Definí tu nueva contraseña para <strong>{{ username }}</strong>.
        </p>

        <div class="field">
          <label for="password">Contraseña</label>
          <input id="password" type="password" formControlName="password" />
          <div class="field-error"
               *ngIf="passForm.get('password')?.touched && passForm.get('password')?.invalid">
            Mínimo 8 caracteres.
          </div>
        </div>

        <div class="field">
          <label for="confirm">Confirmar contraseña</label>
          <input id="confirm" type="password" formControlName="confirm" />
          <div class="field-error"
               *ngIf="passForm.hasError('mismatch') && passForm.touched">
            Las contraseñas no coinciden.
          </div>
        </div>

        <button class="btn-gold" type="submit" [disabled]="loading">
          Guardar contraseña
        </button>
      </form>

      <!-- PASO 4: DONE -->
      <div *ngSwitchCase="'done'">
        <h1>Contraseña actualizada</h1>
        <p class="subtitle">
          Tu contraseña se actualizó correctamente.
        </p>

        <button class="btn-gold" type="button" (click)="goToSignIn()">
          Ir al inicio de sesión
        </button>
      </div>

    </ng-container>

    <p class="info-msg"  *ngIf="infoMsg">{{ infoMsg }}</p>
    <p class="error-msg" *ngIf="errorMsg">{{ errorMsg }}</p>
    <div class="loading-msg" *ngIf="loading">Procesando...</div>
  </div>
</section>
