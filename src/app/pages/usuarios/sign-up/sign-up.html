<section class="auth-page">
  <div class="auth-card" [ngSwitch]="step">

    <!-- PASO 1: FORMULARIO -->
    <form *ngSwitchCase="'form'" [formGroup]="form" (ngSubmit)="submit()">
      <h1>Crear cuenta</h1>
      <p class="subtitle">Registrate para gestionar tus reservas en RestInn.</p>

      <div class="form-grid">
        <div class="field">
          <label for="nombre">Nombre</label>
          <input id="nombre" type="text" formControlName="nombre" />
          <div class="field-error" *ngIf="f.nombre.touched && f.nombre.invalid">
            Ingresá tu nombre.
          </div>
        </div>

        <div class="field">
          <label for="apellido">Apellido</label>
          <input id="apellido" type="text" formControlName="apellido" />
          <div class="field-error" *ngIf="f.apellido.touched && f.apellido.invalid">
            Ingresá tu apellido.
          </div>
        </div>

        <div class="field full">
          <label for="email">Correo electrónico</label>
          <input id="email" type="email" formControlName="email" />
          <div class="field-error" *ngIf="f.email.touched && f.email.invalid">
            Ingresá un correo válido.
          </div>
        </div>

        <div class="field">
          <label for="nombreLogin">Usuario</label>
          <input id="nombreLogin" type="text" formControlName="nombreLogin" />
          <div class="field-error" *ngIf="f.nombreLogin.touched && f.nombreLogin.invalid">
            Elegí un usuario (3 a 30 caracteres).
          </div>
        </div>

        <div class="field">
          <label for="dni">DNI (opcional)</label>
          <input id="dni" type="text" formControlName="dni" />
        </div>

        <div class="field">
          <label for="phoneNumber">Teléfono (opcional)</label>
          <input id="phoneNumber" type="text" formControlName="phoneNumber" />
        </div>

        <div class="field">
          <label for="cuit">CUIT (opcional)</label>
          <input id="cuit" type="text" formControlName="cuit" />
        </div>
      </div>

      <div formGroupName="passGroup" class="pass-group">
        <div class="field">
          <label for="password">Contraseña</label>
          <input id="password" type="password" formControlName="password" />
          <div class="field-error" *ngIf="pass.password.touched && pass.password.invalid">
            Mínimo 8 caracteres.
          </div>
        </div>

        <div class="field">
          <label for="confirm">Confirmar contraseña</label>
          <input id="confirm" type="password" formControlName="confirm" />
          <div
            class="field-error"
            *ngIf="form.get('passGroup')?.touched && form.get('passGroup')?.hasError('mismatch')">
            Las contraseñas no coinciden.
          </div>
        </div>
      </div>

      <div class="auth-actions">
        <button class="btn-gold" type="submit" [disabled]="loading">
          Crear cuenta
        </button>

        <button class="btn-ghost" type="button" (click)="goToSignIn()">
          ¿Ya tenés cuenta? Iniciar sesión
        </button>
      </div>

      <p class="auth-error" *ngIf="errorMsg">{{ errorMsg }}</p>
      <p class="auth-info" *ngIf="infoMsg">{{ infoMsg }}</p>
      <p class="auth-loading" *ngIf="loading">Procesando...</p>
    </form>

    <!-- PASO 2: VERIFICAR CÓDIGO -->
    <div *ngSwitchCase="'verify'" [formGroup]="codeForm">
      <h1>Confirmá tu correo</h1>
      <p class="auth-subtitle">
        Ingresá el código de 6 dígitos.
      </p>

      <div class="code-inputs">
        <input class="code-box" maxlength="1" inputmode="numeric" formControlName="d1" />
        <input class="code-box" maxlength="1" inputmode="numeric" formControlName="d2" />
        <input class="code-box" maxlength="1" inputmode="numeric" formControlName="d3" />
        <input class="code-box" maxlength="1" inputmode="numeric" formControlName="d4" />
        <input class="code-box" maxlength="1" inputmode="numeric" formControlName="d5" />
        <input class="code-box" maxlength="1" inputmode="numeric" formControlName="d6" />
      </div>

      <div class="auth-actions">
        <button type="button" class="btn-gold" (click)="onVerify()" [disabled]="loading">
          Verificar cuenta
        </button>
        <button type="button" class="btn-ghost" (click)="backToForm()" [disabled]="loading">
          Volver al formulario
        </button>
      </div>

      <p class="auth-helper" *ngIf="infoMsg">{{ infoMsg }}</p>
      <p class="auth-error" *ngIf="errorMsg">{{ errorMsg }}</p>
      <p class="auth-loading" *ngIf="loading">Verificando...</p>
    </div>

    <!-- PASO 3: SUCCESS -->
    <div *ngSwitchCase="'success'">
      <h1>Cuenta creada</h1>
      <p class="subtitle">
        Tu cuenta fue confirmada correctamente. Ya podés iniciar sesión.
      </p>

      <button class="btn-gold" type="button" (click)="goToSignIn()">
        Ir al inicio de sesión
      </button>
    </div>

  </div>
</section>
