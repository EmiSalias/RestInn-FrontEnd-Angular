<header>
  <nav class="nav">
    <div class="nav_container">

      <input type="checkbox" id="menu_input" class="nav_input" #menuInput>

      <label class="nav_toggle" for="menu_input"></label>

      <ul class="nav_list">
        @for (item of (menu$ | async); track item.label) {
        <li class="nav_item">

          @if (!item.children) {
          <a [routerLink]="item.link" class="nav_link" (click)="onMenuItemClick()">
            @if (item.icon) {
            <fa-icon [icon]="item.icon"></fa-icon>
            }
            {{ item.label }}
          </a>
          }

          @if (item.children) {
          <button class="nav_link" (click)="toggle(item.label)" [attr.aria-expanded]="openLabel === item.label">
            @if (item.icon) {
            <fa-icon [icon]="item.icon"></fa-icon>
            }
            {{ item.label }}
            <fa-icon [icon]="faChevronDown" class="chevron"></fa-icon>
          </button>

          <ul class="submenu" [class.open]="openLabel === item.label">
            @for (sub of item.children; track sub.label) {
            <li>
              <a [routerLink]="sub.link" (click)="onMenuItemClick()">
                {{ sub.label }}
              </a>
            </li>
            }
          </ul>
          }

        </li>
        }
      </ul>

      <!-- Overlay clicable para cerrar el menú -->
      <label class="nav_overlay" for="menu_input"></label>

      <figure class="nav_figure">
        <a routerLink="/" class="nav_logo-link" aria-label="Ir al inicio">
          <img [src]="isDarkTheme ? 'assets/logos/logo-header.png' : 'assets/logos/logo-header-claro.png'"
            alt="Logo RestInn, gestión hotelera" class="nav_logo" />
        </a>
      </figure>


      <div class="nav_actions">
        <!-- BOTÓN TEMA -->
        <button type="button" class="theme-toggle" (click)="toggleTheme()"
          [attr.aria-label]="isDarkTheme ? 'Cambiar a modo claro' : 'Cambiar a modo oscuro'">
          <fa-icon [icon]="isDarkTheme ? faSun : faMoon"></fa-icon>
        </button>

        <div class="user-menu" #userMenu>
          @if (userInfo$ | async; as info) {
          <span class="user-greeting">
            Bienvenido, {{ info.displayName }}
          </span>

          <button type="button" class="user-menu-btn" (click)="toggleUserMenu()">
            <fa-icon [icon]="getRoleIcon(info.roleRaw)"></fa-icon>
          </button>
          } @else {
          <button type="button" class="user-menu-btn" (click)="toggleUserMenu()">
            <fa-icon [icon]="faUser"></fa-icon>
          </button>
          }

          <div class="user-menu-dropdown" [class.open]="userMenuOpen">
            @if (isLoggedIn$ | async) {
            <button type="button" class="user-menu-item" routerLink="/mi_perfil" (click)="closeUserMenu()">
              Mi perfil
            </button>

            <button type="button" class="user-menu-item user-menu-logout" (click)="logout()">
              Cerrar sesión
            </button>
            } @else {
            <button type="button" class="user-menu-item" routerLink="/sign_in" (click)="closeUserMenu()">
              Iniciar sesión
            </button>

            <button type="button" class="user-menu-item" routerLink="/sign_up" (click)="closeUserMenu()">
              Registrarse
            </button>
            }
          </div>
        </div>
      </div>

    </div>
  </nav>
</header>